@model WebShop.Model.ItemListViewModel
@inject DAL.Interfaces.IArtistRepository _artistRepository
@inject DAL.Interfaces.ICategoryRepository _categoryRepository
@inject DAL.Interfaces.ITagRepository _tagRepository

@{
    ViewBag.Title = "Index";

    var categories = _categoryRepository.GetAll();
    var artists = _artistRepository.GetAll();
    var tags = _tagRepository.GetAll();
}

<button id="filter-toggle-btn" class="btn btn-primary">Show Filters</button>

<div id="filter-container">
    <form id="filter-form" asp-action="Index" asp-controller="Item" method="get">
        <div class="form-group">
            <label for="searchQuery">Search</label>
            <input type="text" name="SearchQuery" class="form-control" value="@Model.searchQuery" />
        </div>
        <div class="form-group">
            <label for="priceMin">Minimum Price</label>
            <input type="number" name="PriceMin" class="form-control" value="@Model.priceMin" />
        </div>
        <div class="form-group">
            <label for="priceMax">Maximum Price</label>
            <input type="number" name="PriceMax" class="form-control" value="@Model.priceMax" />
        </div>
        <div class="form-group">
            <label for="categories">Categories</label>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownCategories" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select Categories
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownCategories">
                    @foreach (var category in categories)
                    {
                        <div class="form-check dropdown-item">
                            <input class="form-check-input" type="checkbox" name="selectedCategories" value="@category.CategoryId" @(Model.selectedCategories.Contains(category.CategoryId) ? "checked" : "") />
                            <label class="form-check-label" for="categories">
                                @category.Name
                            </label>
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="artists">Artists</label>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownArtists" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select Artists
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownArtists">
                    @foreach (var artist in artists)
                    {
                        <div class="form-check dropdown-item">
                            <input class="form-check-input" type="checkbox" name="selectedArtists" value="@artist.ArtistId" @(Model.selectedArtists.Contains(artist.ArtistId) ? "checked" : "") />
                            <label class="form-check-label" for="artists">
                                @artist.Name
                            </label>
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="tags">Tags</label>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownTags" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select Tags
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownTags">
                    @foreach (var tag in tags)
                    {
                        <div class="form-check dropdown-item">
                            <input class="form-check-input" type="checkbox" name="selectedTags" value="@tag.TagId" @(Model.selectedTags.Contains(tag.TagId) ? "checked" : "") />
                            <label class="form-check-label" for="tags">
                                @tag.Name
                            </label>
                        </div>
                    }
                </div>
            </div>
        </div>
        <input type="hidden" name="PageNumber" id="PageNumber" value="1" />

        <button type="submit" id="filterButton" class="btn btn-primary">Filter</button>
    </form>
</div>

<p>
    <a asp-action="Create">Create New</a>
</p>
<div id="items-container">
    @await Html.PartialAsync("_ItemsListPartial", Model)
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#filterButton').on('click', function () {
                $('#PageNumber').val(1);
            });

            function loadItems() {
                $.ajax({
                    url: '@Url.Action("Index", "Item")',
                    type: 'GET',
                    data: $('#filter-form').serialize(),
                    success: function (result) {
                        $('#items-container').html(result);
                        var pageNumber = $('.pagination').find('.active').text();
                        $('#PageNumber').val(pageNumber);
                    }
                });
            }

            window.loadPage = function (pageNumber) {
                $('#PageNumber').val(pageNumber);
                loadItems();
            }

            // Toggle filter container visibility
            $('#filter-toggle-btn').on('click', function () {
                $('#filter-container').toggleClass('open');
                $(this).text(function (i, text) {
                    return text === "Show Filters" ? "Hide Filters" : "Show Filters";
                });
            });
        });
    </script>
}

<style>
    #filter-container {
        position: fixed;
        top: 0;
        right: -320px; /* Start hidden off-screen */
        width: 300px;
        height: 100%;
        background-color: #2c2c2c; /* Dark gray background color */
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
        transition: right 0.3s ease;
        padding: 20px;
        overflow-y: auto;
        z-index: 1000;
        color: #FF9800; /* Orange text color */
    }

        #filter-container.open {
            right: 0;
        }

    #filter-toggle-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1100;
    }

    .form-group label {
        color: #FF9800;
    }

    .form-control {
        color: #000;
    }

    .dropdown-menu {
        max-height: 200px;
        overflow-y: auto;
    }

    .form-check {
        margin-bottom: 5px;
    }

    .form-check-input {
        margin-right: 10px;
    }

    .form-check-label {
        color: #FFA726;
    }
</style>
