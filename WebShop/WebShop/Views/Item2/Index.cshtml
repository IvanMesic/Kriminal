@model WebShop.Model.ItemListViewModel

<form id="filter-form" asp-action="Index" asp-controller="Item" method="get">
    <div class="form-group">
        <label for="searchQuery">Search</label>
        <input type="text" name="SearchQuery" class="form-control" value="@Model.Filter.SearchQuery" />
    </div>
    <div class="form-group">
        <label for="priceMin">Minimum Price</label>
        <input type="number" name="PriceMin" class="form-control" value="@Model.Filter.PriceMin" />
    </div>
    <div class="form-group">
        <label for="priceMax">Maximum Price</label>
        <input type="number" name="PriceMax" class="form-control" value="@Model.Filter.PriceMax" />
    </div>
    <div class="form-group">
        <label for="categories">Categories</label>
        <select asp-for="Filter.SelectedCategories" asp-items="Model.Filter.Categories" class="form-control" multiple="multiple"></select>
    </div>
    <div class="form-group">
        <label for="artists">Artists</label>
        <select asp-for="Filter.SelectedArtists" asp-items="Model.Filter.Artists" class="form-control" multiple="multiple"></select>
    </div>
    <div class="form-group">
        <label for="tags">Tags</label>
        <select asp-for="Filter.SelectedTags" asp-items="Model.Filter.Tags" class="form-control" multiple="multiple"></select>
    </div>
    <div class="form-group">
        <label for="pageSize">Page Size</label>
        <input type="number" name="PageSize" class="form-control" value="@Model.Filter.PageSize" />
    </div>
    <input type="hidden" name="PageNumber" id="PageNumber" value="@Model.Filter.PageNumber" />


    <button type="submit" id="filterButton" class="btn btn-primary">Filter</button>
</form>

<div id="items-container">
    @Html.Partial("_ItemList", Model)
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Using event delegation for dynamically added elements
            $(document).on('click', '.edit-link, .details-link', function (event) {
                event.preventDefault();
                var url = $(this).attr('href');
                // Perform AJAX request or redirect
                window.location.href = url; // For simplicity, just redirect
            });
        });


        $('#filterButton').on('click', function () {
            $('#PageNumber').val(1);  // Reset hidden PageNumber input to 1
        });

        function loadItems() {
            $.ajax({
                url: '@Url.Action("Index", "Item")',
                type: 'GET',
                data: $('#filter-form').serialize(),
                success: function (result) {
                    $('#items-container').html(result);

                    // Update page number in hidden field
                    var pageNumber = $('.pagination').find('.active').text();
                    $('#PageNumber').val(pageNumber);
                }
            });
        }

        function loadPage(pageNumber) {
            $('#PageNumber').val(pageNumber);
            loadItems();
        }

    </script>
}
