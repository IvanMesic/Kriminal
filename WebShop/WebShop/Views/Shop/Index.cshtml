@model WebShop.Model.ItemListViewModel
@inject DAL.Interfaces.IArtistRepository _artistRepository
@inject DAL.Interfaces.ICategoryRepository _categoryRepository
@inject DAL.Interfaces.ITagRepository _tagRepository

@{
    ViewBag.Title = "Index";

    var categories = new MultiSelectList(_categoryRepository.GetAll(), "CategoryId", "Name");
    var artists = new MultiSelectList(_artistRepository.GetAll(), "ArtistId", "Name");
    var tags = new MultiSelectList(_tagRepository.GetAll(), "TagId", "Name");
}

<button id="filter-toggle-btn" class="btn btn-primary">Show Filters</button>

<div id="filter-container">
    <form id="filter-form" asp-action="Index" asp-controller="Shop" method="get">
        <div class="form-group">
            <label for="searchQuery">Search</label>
            <input type="text" name="SearchQuery" class="form-control" value="@Model.searchQuery" />
        </div>
        <div class="form-group">
            <label for="priceMin">Minimum Price</label>
            <input type="number" name="PriceMin" class="form-control" value="@Model.priceMin" />
        </div>
        <div class="form-group">
            <label for="priceMax">Maximum Price</label>
            <input type="number" name="PriceMax" class="form-control" value="@Model.priceMax" />
        </div>
        <div class="form-group">
            <label for="categories">Categories</label>
            @Html.ListBoxFor(m => m.selectedCategories, categories, new { @class = "form-control", multiple = "multiple" })
        </div>
        <div class="form-group">
            <label for="artists">Artists</label>
            @Html.ListBoxFor(m => m.selectedArtists, artists, new { @class = "form-control", multiple = "multiple" })
        </div>
        <div class="form-group">
            <label for="tags">Tags</label>
            @Html.ListBoxFor(m => m.selectedTags, tags, new { @class = "form-control", multiple = "multiple" })
        </div>
        <input type="hidden" name="PageNumber" id="PageNumber" value="1" />

        <button type="submit" id="filterButtonShop" class="btn btn-primary">Filter</button>
    </form>
</div>

<div id="items-container">
    @await Html.PartialAsync("~/Views/Shop/_ItemsListPartialShop.cshtml", Model)

</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#filterButtonShop').on('click', function () {
                $('#PageNumber').val(1);
            });

            function loadShopItems() {
                $.ajax({
                    url: '@Url.Action("Index", "Shop")',
                    type: 'GET',
                    data: $('#filter-form').serialize(),
                    success: function (result) {
                        $('#items-container').html(result);
                        var pageNumber = $('.pagination').find('.active').text();
                        $('#PageNumber').val(pageNumber);
                    }
                });
            }

            window.loadPage = function (pageNumber) {
                $('#PageNumber').val(pageNumber);
                loadShopItems();
            }

            // Toggle filter container visibility
            $('#filter-toggle-btn').on('click', function () {
                $('#filter-container').toggleClass('open');
                $(this).text(function (i, text) {
                    return text === "Show Filters" ? "Hide Filters" : "Show Filters";
                });
            });
        });
    </script>
}

<style>
    #filter-container {
        position: fixed;
        top: 0;
        right: -300px; /* Width of the filter form */
        width: 300px;
        height: 100%;
        background-color: #f8f9fa;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
        transition: right 0.3s ease;
        padding: 20px;
        overflow-y: auto;
        z-index: 1000;
    }

        #filter-container.open {
            right: 0;
        }

    #filter-toggle-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1100;
    }
</style>
